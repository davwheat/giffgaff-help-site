var pcaInstance,gg=gg||{};gg.widgets=gg.widgets||{},gg.widgets.postcodeAnywhere=function(i,s){s=s||!1;var n,o=null,r=null,d=null;function l(e){return e.attr("name").replace("postcode","")}function c(e,n){var t,i;(function(e){if(0<e.siblings(".help-block").length)return $(e.siblings(".help-block")[0]);var n=$('<span class="help-block address-selected hide"></span>');return e.after(n),n})(n).html(utilsReplaceSpecialCharacters((t=e,i=[],!t.Company||i.push(t.Company),!t.Line1||i.push(t.Line1),!t.Line2||i.push(t.Line2),!t.Line3||i.push(t.Line3),!t.City||i.push(t.City),!t.PostalCode||i.push(t.PostalCode),!t.CountryName||i.push(t.CountryName),i.join("<br/>")),"And")).removeClass("hide").show()}function u(e){e&&(e.find(".paf_hide").each(function(){$(this).parents(".control-group").addClass("hide")}),e.find(".paf_hide_exc").each(function(){$(this).parents(".control-group").addClass("hide")}))}function f(e){container=e.parents(".ukAddress"),container.find(".paf_hide").each(function(){$(this).parents(".control-group").removeClass("hide")}),container.find(".address-selected").hide(),e.parent().parent().find("label").html("Postcode")}return{init:function(){function a(e){var t=-1;return $.each(e.fields,function(e,n){"{PostalCode}"===n.field&&(t=e)}),t}return n=this,pca.on("options",function(e,n,t){"capture+"===e&&(t.manualEntryItem=!0,t.disableTime=2e3)}),pca.on("load",function(e,n,t){t.listen("manual",function(){var e=a(t);f($("#"+t.fields[e].element))}),t.listen("error",function(e,n,t){if("capture+"===e){var i=a(t);f($("#"+t.fields[i].element))}}),t.listen("populate",function(e){if(o){u(o),r.valid();var n,t,i=l(r);c(e,r),utilsGetAddressLookupFields().forEach(function(e){var n,t=o.find(".ukAddress");(n=0<t.length?t.find("[name*="+i+e+"]"):o.find("[name*="+i+e+"]")).val(utilsTruncateAddressLine(n.val()))}),n=i,t=e,$.isFunction(d)&&d(n,t)}}),$(i).each(function(){var e,n,t=$(this).closest("form");($(this).attr("autocomplete","pca-field"),$(this).attr("placeholder","Type your address to search").on("focus",function(){o=$(this).closest("form"),r=$(this)}),s?$(this).parent().parent().find("label").html("Postcode"):u(t),""!==$(this).val())&&c((e=t,n=l($(this)),{Company:$.trim(e.find("[name*="+n+"buildingName]").val()),Line1:$.trim(e.find("[name*="+n+"buildingNum]").val()+" "+e.find("[name*="+n+"street]").val()),Line2:$.trim(e.find("[name*="+n+"line1]").val()),Line3:$.trim(e.find("[name*="+n+"line2]").val()),Province:$.trim(e.find("[name*="+n+"locality]").val()),City:$.trim(e.find("[name*="+n+"city]").val()),CountryName:"",PostalCode:$.trim(e.find("[name*="+n+"postcode]").val())}),$(this))})}),n},setAddressPopulatedHandler:function(e){return d=e,n}}},$(document).ready(function(){"undefined"==typeof showAddressForms&&(showAddressForms=!1),pcaInstance=gg.widgets.postcodeAnywhere(".postcode",showAddressForms).init()});